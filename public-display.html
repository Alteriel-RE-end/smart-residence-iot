<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layar Publik - Status Hunian</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: { extend: { colors: { slate: {50:'#f8fafc',100:'#f1f5f9',800:'#1e293b',900:'#0f172a'}, emerald: {500:'#10b981'}, rose: {500:'#f43f5e'} } } }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; }
        .card-glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.5s ease;
        }
        /* Animasi Status */
        .status-avail { color: #10b981; text-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
        .status-occ { color: #f43f5e; text-shadow: 0 0 20px rgba(244, 63, 94, 0.3); }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-gradient-to-br from-slate-900 to-slate-800 relative">

    <!-- Header & Summary -->
    <header class="px-10 py-8 border-b border-white/10 bg-slate-900/50 flex justify-between items-center">
        <div class="flex items-center gap-6">
            <div class="bg-white/10 p-4 rounded-2xl">
                <i class="fa-solid fa-hotel text-4xl text-emerald-400"></i>
            </div>
            <div>
                <h1 class="text-3xl font-bold tracking-wider text-white uppercase">Status Hunian</h1>
                <p class="text-slate-400 text-lg">Smart Residence Information</p>
            </div>
        </div>
        
        <!-- PANEL RINGKASAN KETERSEDIAAN -->
        <div class="text-right">
            <div id="availability-summary" class="text-2xl font-bold text-emerald-400 uppercase tracking-widest mb-1 animate-pulse">
                Memuat Data...
            </div>
            <div class="text-slate-400 text-sm font-mono" id="clock">00:00 • Senin, 1 Jan 2025</div>
        </div>
    </header>

    <!-- Main Grid -->
    <main class="flex-grow p-10 grid grid-cols-3 gap-10 items-center">
        
        <!-- KAMAR 1 -->
        <div id="card-kamar1" class="card-glass rounded-3xl p-8 h-96 flex flex-col justify-between relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-3 h-full bg-slate-700 transition-all duration-500" id="bar-kamar1"></div>
            <div class="pl-6">
                <div class="flex justify-between items-start">
                    <h2 class="text-4xl font-bold text-white">Kamar 1</h2>
                    <i class="fa-solid fa-bed text-4xl text-slate-600 transition-colors duration-500" id="icon-kamar1"></i>
                </div>
                <p class="text-slate-400 text-xl mt-2">Master Suite</p>
            </div>
            
            <div class="text-center">
                <span id="status-text-kamar1" class="text-5xl font-black tracking-widest text-slate-600 transition-all duration-500">--</span>
            </div>
            
            <div class="text-center">
                <span id="msg-kamar1" class="text-sm font-medium px-4 py-2 rounded-full bg-slate-800 text-slate-500 uppercase tracking-wide">System Check</span>
            </div>
        </div>

        <!-- VILLA 1 -->
        <div id="card-villa1" class="card-glass rounded-3xl p-8 h-96 flex flex-col justify-between relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-3 h-full bg-slate-700 transition-all duration-500" id="bar-villa1"></div>
            <div class="pl-6">
                <div class="flex justify-between items-start">
                    <h2 class="text-4xl font-bold text-white">Villa 1</h2>
                    <i class="fa-solid fa-house text-4xl text-slate-600 transition-colors duration-500" id="icon-villa1"></i>
                </div>
                <p class="text-slate-400 text-xl mt-2">Garden View</p>
            </div>
            
            <div class="text-center">
                <span id="status-text-villa1" class="text-5xl font-black tracking-widest text-slate-600 transition-all duration-500">--</span>
            </div>
            
            <div class="text-center">
                <span id="msg-villa1" class="text-sm font-medium px-4 py-2 rounded-full bg-slate-800 text-slate-500 uppercase tracking-wide">System Check</span>
            </div>
        </div>

        <!-- VILLA 2 -->
        <div id="card-villa2" class="card-glass rounded-3xl p-8 h-96 flex flex-col justify-between relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-3 h-full bg-slate-700 transition-all duration-500" id="bar-villa2"></div>
            <div class="pl-6">
                <div class="flex justify-between items-start">
                    <h2 class="text-4xl font-bold text-white">Villa 2</h2>
                    <i class="fa-solid fa-house-chimney text-4xl text-slate-600 transition-colors duration-500" id="icon-villa2"></i>
                </div>
                <p class="text-slate-400 text-xl mt-2">Pool Side</p>
            </div>
            
            <div class="text-center">
                <span id="status-text-villa2" class="text-5xl font-black tracking-widest text-slate-600 transition-all duration-500">--</span>
            </div>
            
            <div class="text-center">
                <span id="msg-villa2" class="text-sm font-medium px-4 py-2 rounded-full bg-slate-800 text-slate-500 uppercase tracking-wide">System Check</span>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 py-3 border-t border-white/10 relative">
        <marquee class="text-emerald-400 text-lg font-mono tracking-wide">
            SELAMAT DATANG DI SMART RESIDENCE • SILAKAN MENUJU RESEPSIONIS UNTUK CHECK-IN • AREA INI DI MONITOR 24 JAM • FREE WI-FI TERSEDIA
        </marquee>
        
        <!-- TOMBOL LOGIN TERSEMBUNYI (POJOK KANAN BAWAH) -->
        <a href="login.html" class="absolute bottom-3 right-3 text-white/10 hover:text-emerald-500 transition-all duration-300 z-50 p-2" title="Admin Login">
            <i class="fa-solid fa-key text-lg"></i>
        </a>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDqDNjxb9SeDzB8WUj0GIzvZQPcj_CmjZM",
            authDomain: "smart-residence-iot.firebaseapp.com",
            databaseURL: "https://smart-residence-iot-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "smart-residence-iot",
            storageBucket: "smart-residence-iot.firebasestorage.app",
            messagingSenderId: "354143267738",
            appId: "1:354143267738:web:abb4f68406c6905b6f2823"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Clock
        setInterval(() => {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'});
            const dateStr = now.toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
            document.getElementById('clock').innerText = `${timeStr} • ${dateStr}`;
        }, 1000);

        // MODIFIED: MENGAMBIL DATA DARI USERS (PERSISTENT), BUKAN MONITORING
        onValue(ref(db, 'users'), (snapshot) => {
            const users = snapshot.val() || {};
            
            // 1. Reset Status Awal (Semua Kosong)
            let statusData = {
                kamar1: null, // null artinya kosong
                villa1: null,
                villa2: null
            };

            // 2. Cek setiap user, apakah sedang check-in
            Object.values(users).forEach(user => {
                if (user.currentLocation && user.currentLocation !== "-") {
                    // Normalisasi string lokasi agar cocok dengan ID (misal: "Villa 2" -> "villa2")
                    let loc = user.currentLocation.toLowerCase().replace(/\s/g, ''); // hapus spasi & lowercase
                    
                    // Mapping manual untuk keamanan
                    if(loc === "kamar1") statusData.kamar1 = user.name;
                    else if(loc === "villa1") statusData.villa1 = user.name;
                    else if(loc === "villa2") statusData.villa2 = user.name;
                }
            });

            // 3. Hitung Ketersediaan untuk Summary
            let emptyKamar = !statusData.kamar1 ? 1 : 0;
            let emptyVilla = 0;
            if(!statusData.villa1) emptyVilla++;
            if(!statusData.villa2) emptyVilla++;

            // 4. Update Summary Text
            const summaryEl = document.getElementById('availability-summary');
            if(emptyKamar === 0 && emptyVilla === 0) {
                summaryEl.innerText = "MOHON MAAF, HUNIAN PENUH";
                summaryEl.className = "text-2xl font-bold text-rose-500 uppercase tracking-widest mb-1 animate-pulse";
            } else {
                summaryEl.innerText = `TERSEDIA: ${emptyKamar} KAMAR • ${emptyVilla} VILLA`;
                summaryEl.className = "text-2xl font-bold text-emerald-400 uppercase tracking-widest mb-1";
            }

            // 5. Update Kartu UI
            updateCard('kamar1', statusData.kamar1);
            updateCard('villa1', statusData.villa1);
            updateCard('villa2', statusData.villa2);
        });

        function updateCard(id, guestName) {
            const isOccupied = guestName !== null && guestName !== undefined;
            
            const els = {
                bar: document.getElementById(`bar-${id}`),
                icon: document.getElementById(`icon-${id}`),
                status: document.getElementById(`status-text-${id}`),
                msg: document.getElementById(`msg-${id}`)
            };

            if(isOccupied) {
                // Tampilan Terisi
                els.bar.className = "absolute top-0 left-0 w-3 h-full bg-rose-500 shadow-[0_0_30px_rgba(244,63,94,0.4)]";
                els.icon.className = `fa-solid ${id.includes('kamar')?'fa-bed':'fa-house'} text-4xl text-rose-500`;
                els.status.innerText = "OCCUPIED";
                els.status.className = "text-5xl font-black tracking-widest status-occ";
                els.msg.innerText = "TIDAK TERSEDIA"; // Bisa ganti guestName jika ingin menampilkan nama
                els.msg.className = "text-sm font-bold px-4 py-2 rounded-full bg-rose-900/50 text-rose-200 border border-rose-500/30 uppercase tracking-wide";
            } else {
                // Tampilan Kosong
                els.bar.className = "absolute top-0 left-0 w-3 h-full bg-emerald-500 shadow-[0_0_30px_rgba(16,185,129,0.4)]";
                els.icon.className = `fa-solid ${id.includes('kamar')?'fa-bed':'fa-house'} text-4xl text-emerald-500`;
                els.status.innerText = "AVAILABLE";
                els.status.className = "text-5xl font-black tracking-widest status-avail";
                els.msg.innerText = "SIAP DIGUNAKAN";
                els.msg.className = "text-sm font-bold px-4 py-2 rounded-full bg-emerald-900/50 text-emerald-200 border border-emerald-500/30 uppercase tracking-wide";
            }
        }
    </script>
</body>
</html>